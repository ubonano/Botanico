rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
  
    // Regla para la colección de perfiles de usuario
    match /userProfiles/{userId} {
      allow read, delete: if request.auth != null && request.auth.uid == userId;
      
      // Validación adicional para la creación y actualización de un perfil de usuario
      allow update, create: if request.auth != null && request.auth.uid == userId
                   && request.resource.data.keys().hasAll(['email', 'name', 'birthDate', 'phone', 'dni'])
                   && request.resource.data.email is string
                   && request.resource.data.email.matches('^[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}$')
                   // Asegúrate de que birthDate coincida con el formato DD/MM/AAAA
                   && request.resource.data.birthDate is string
                   && request.resource.data.birthDate.matches('^(0[1-9]|[12][0-9]|3[01])/(0[1-9]|1[012])/(19|20)\\d{2}$')
                   // Verifica que phone sea un string numérico
                   && request.resource.data.phone is string && request.resource.data.phone.matches('^\\d+$')
                   // Verifica que dni sea un string numérico
                   && request.resource.data.dni is string && request.resource.data.dni.matches('^\\d+$');
    }
  }
}
